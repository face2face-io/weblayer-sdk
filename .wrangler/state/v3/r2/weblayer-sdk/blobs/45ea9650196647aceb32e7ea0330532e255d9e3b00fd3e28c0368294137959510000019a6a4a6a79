/*! For license information please see weblayer-sdk.min.js.LICENSE.txt */
(()=>{"use strict";var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{default:()=>N});const r={apiUrl:"https://api.weblayer.ai",debug:!1,org_id:null,weblayerEnabled:!0};function n(e,t){var r,n,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:365,i=(r=window.location.hostname,(n=r.split(".")).length<=1?r:"."+n.slice(-2).join(".")),a=new Date;a.setTime(a.getTime()+24*o*60*60*1e3);var s="".concat(e,"=").concat(t,"; expires=").concat(a.toUTCString(),"; domain=").concat(i,"; path=/; SameSite=Lax");document.cookie=s}function o(){var e,t,r="weblayer_visitor_id",o="weblayer_visitor_id",i=(e=r,2===(t="; ".concat(document.cookie).split("; ".concat(e,"="))).length?t.pop().split(";").shift():null);if(i){try{localStorage.setItem(o,i)}catch(e){}return i}try{if(i=localStorage.getItem(o))return n(r,i),i}catch(e){}i="".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2,15));try{n(r,i),localStorage.setItem(o,i)}catch(e){}return i}function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,s=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(e){c=!0,o=e}finally{try{if(!l&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw o}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return a(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function s(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var s=n&&n.prototype instanceof c?n:c,u=Object.create(s.prototype);return l(u,"_invoke",function(r,n,o){var i,s,l,c=0,u=o||[],d=!1,_={p:0,n:0,v:e,a:g,f:g.bind(e,4),d:function(t,r){return i=t,s=0,l=e,_.n=r,a}};function g(r,n){for(s=r,l=n,t=0;!d&&c&&!o&&t<u.length;t++){var o,i=u[t],g=_.p,f=i[2];r>3?(o=f===n)&&(l=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=e):i[0]<=g&&((o=r<2&&g<i[1])?(s=0,_.v=n,_.n=i[1]):g<f&&(o=r<3||i[0]>n||n>f)&&(i[4]=r,i[5]=n,_.n=f,s=0))}if(o||r>1)return a;throw d=!0,n}return function(o,u,f){if(c>1)throw TypeError("Generator is already running");for(d&&1===u&&g(u,f),s=u,l=f;(t=s<2?e:l)||!d;){i||(s?s<3?(s>1&&(_.n=-1),g(s,l)):_.n=l:_.v=l);try{if(c=2,i){if(s||(o="next"),t=i[o]){if(!(t=t.call(i,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,s<2&&(s=0)}else 1===s&&(t=i.return)&&t.call(i),s<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),s=1);i=e}else if((t=(d=_.n<0)?l:r.call(n,_))!==a)break}catch(t){i=e,s=1,l=t}finally{c=1}}return{value:t,done:d}}}(r,o,i),!0),u}var a={};function c(){}function u(){}function d(){}t=Object.getPrototypeOf;var _=[][n]?t(t([][n]())):(l(t={},n,function(){return this}),t),g=d.prototype=c.prototype=Object.create(_);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,l(e,o,"GeneratorFunction")),e.prototype=Object.create(g),e}return u.prototype=d,l(g,"constructor",d),l(d,"constructor",u),u.displayName="GeneratorFunction",l(d,o,"GeneratorFunction"),l(g),l(g,o,"Generator"),l(g,n,function(){return this}),l(g,"toString",function(){return"[object Generator]"}),(s=function(){return{w:i,m:f}})()}function l(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}l=function(e,t,r,n){function i(t,r){l(e,t,function(e){return this._invoke(t,r,e)})}t?o?o(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(i("next",0),i("throw",1),i("return",2))},l(e,t,r,n)}function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function u(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function d(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){u(i,n,o,a,s,"next",e)}function s(e){u(i,n,o,a,s,"throw",e)}a(void 0)})}}var _=[],g=null;function f(e){_.push(e);var t=JSON.stringify(_).length;_.length>=50||t>=65536?m():g||(g=setTimeout(m,5e3))}var v=window.fetch;function m(){return w.apply(this,arguments)}function w(){return(w=d(s().m(function e(){var t;return s().w(function(e){for(;;)switch(e.p=e.n){case 0:if(_.length){e.n=1;break}return e.a(2);case 1:return t=_,_=[],clearTimeout(g),g=null,e.p=2,e.n=3,v("".concat(r.apiUrl,"/qwerty/events"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({events:t})});case 3:e.n=5;break;case 4:e.p=4,e.v;case 5:return e.a(2)}},e,null,[[2,4]])}))).apply(this,arguments)}function y(){return(new Date).toISOString()}function p(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:120;return e?String(e).replace(/\s+/g," ").slice(0,t):null}function h(e){if(r.weblayerEnabled&&e&&r.org_id){var t=sessionStorage.getItem("weblayer_session_id");t||(t="".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2)),sessionStorage.setItem("weblayer_session_id",t)),f({ts:y(),org_id:r.org_id,visitor_id:e,session_id:t,page_url:window.location.href,referrer:document.referrer||null,event_type:"navigation",event_name:"load",event_data:{title:document.title}}),window.addEventListener("error",function(n){var o=sessionStorage.getItem("weblayer_session_id")||t;f({ts:y(),org_id:r.org_id,visitor_id:e,session_id:o,page_url:window.location.href,referrer:document.referrer||null,event_type:"error",event_name:"window.onerror",event_data:{message:n.message,filename:n.filename,lineno:n.lineno,colno:n.colno}})}),window.addEventListener("unhandledrejection",function(n){var o=sessionStorage.getItem("weblayer_session_id")||t;f({ts:y(),org_id:r.org_id,visitor_id:e,session_id:o,page_url:window.location.href,referrer:document.referrer||null,event_type:"error",event_name:"unhandledrejection",event_data:{message:p(n.reason&&(n.reason.message||String(n.reason)))}})}),document.addEventListener("invalid",function(n){var o=sessionStorage.getItem("weblayer_session_id")||t,i=n.target;f({ts:y(),org_id:r.org_id,visitor_id:e,session_id:o,page_url:window.location.href,referrer:document.referrer||null,event_type:"validation_error",event_name:"invalid",event_data:{element:i.tagName.toLowerCase(),type:i.type||null,name:i.name||null,id:i.id||null,validation_message:i.validationMessage||null,value_length:(i.value||"").length}})},!0);var n=new WeakMap,o=new WeakMap;document.addEventListener("focus",function(e){return X("focus",e)},!0),document.addEventListener("blur",function(e){return X("blur",e)},!0),document.addEventListener("input",function(e){return X("input",e)},!0),document.addEventListener("change",function(e){return X("change",e)},!0),document.addEventListener("submit",function(o){try{var i=o.target;if(!i||"FORM"!==i.tagName)return;var a=sessionStorage.getItem("weblayer_session_id")||t,s=n.get(i),l=s?Date.now()-s:null,c=i.querySelectorAll("input, textarea, select").length;f({ts:y(),org_id:r.org_id,visitor_id:e,session_id:a,page_url:window.location.href,referrer:document.referrer||null,event_type:"form_interaction",event_name:"submit",event_data:{form_id:i.id||null,field_count:c,completion_time_ms:l}}),n.delete(i)}catch(o){r.debug&&console.warn("[weblayer] Failed to track form submit:",o)}},!0),document.addEventListener("focus",function(e){try{var t=e.target;if(!t||!t.tagName)return;var r=t.tagName.toLowerCase();if(!["input","textarea","select"].includes(r))return;var o=t.closest("form");o&&!n.has(o)&&n.set(o,Date.now())}catch(e){}},!0),document.addEventListener("focusin",function(n){try{var o=n.target,i=sessionStorage.getItem("weblayer_session_id")||t;f({ts:y(),org_id:r.org_id,visitor_id:e,session_id:i,page_url:window.location.href,referrer:document.referrer||null,event_type:"focus",event_name:"focusin",event_data:{target_tag:o&&o.tagName?o.tagName.toLowerCase():null,target_id:o&&o.id||null,target_classes:o&&o.className||null}})}catch(n){r.debug&&console.warn("[weblayer] Failed to track focusin:",n)}},!0),document.addEventListener("focusout",function(n){try{var o=n.target,i=sessionStorage.getItem("weblayer_session_id")||t;f({ts:y(),org_id:r.org_id,visitor_id:e,session_id:i,page_url:window.location.href,referrer:document.referrer||null,event_type:"focus",event_name:"focusout",event_data:{target_tag:o&&o.tagName?o.tagName.toLowerCase():null,target_id:o&&o.id||null,target_classes:o&&o.className||null}})}catch(n){r.debug&&console.warn("[weblayer] Failed to track focusout:",n)}},!0);var a=console.error,l=console.warn;console.error=function(){try{var n=sessionStorage.getItem("weblayer_session_id")||t,o=Array.from(arguments).map(function(e){return"object"===c(e)?JSON.stringify(e):String(e)}).join(" ");f({ts:y(),org_id:r.org_id,visitor_id:e,session_id:n,page_url:window.location.href,referrer:document.referrer||null,event_type:"console",event_name:"error",event_data:{message:p(o,500)}})}catch(e){}return a.apply(console,arguments)},console.warn=function(){try{var n=sessionStorage.getItem("weblayer_session_id")||t,o=Array.from(arguments).map(function(e){return"object"===c(e)?JSON.stringify(e):String(e)}).join(" ");f({ts:y(),org_id:r.org_id,visitor_id:e,session_id:n,page_url:window.location.href,referrer:document.referrer||null,event_type:"console",event_name:"warn",event_data:{message:p(o,500)}})}catch(e){}return l.apply(console,arguments)};var u=window.fetch;u.__weblayerWrapped||(window.fetch=function(){var n=d(s().m(function n(o,i){var a,l,c,d,_,g,v,m,w,h=arguments;return s().w(function(n){for(;;)switch(n.p=n.n){case 0:if(!h[0]||"string"!=typeof h[0]||!h[0].includes("/qwerty/events")){n.n=1;break}return n.a(2,u.apply(this,h));case 1:return a=performance.now(),l="string"==typeof o?o:o instanceof Request?o.url:String(o),c=i&&i.method||o instanceof Request&&o.method||"GET",n.p=2,n.n=3,u.apply(this,h);case 3:d=n.v,_=Math.round(performance.now()-a),g=sessionStorage.getItem("weblayer_session_id")||t;try{f({ts:y(),org_id:r.org_id,visitor_id:e,session_id:g,page_url:window.location.href,referrer:document.referrer||null,event_type:"network",event_name:c,event_data:{url:l,method:c},status:d.status,duration_ms:_})}catch(e){r.debug&&console.warn("[weblayer] Failed to track fetch:",e)}return n.a(2,d);case 4:n.p=4,w=n.v,v=Math.round(performance.now()-a),m=sessionStorage.getItem("weblayer_session_id")||t;try{f({ts:y(),org_id:r.org_id,visitor_id:e,session_id:m,page_url:window.location.href,referrer:document.referrer||null,event_type:"network",event_name:c,event_data:{url:l,method:c,error:p(w&&w.message)},status:0,duration_ms:v})}catch(e){r.debug&&console.warn("[weblayer] Failed to track fetch error:",e)}throw w;case 5:return n.a(2)}},n,this,[[2,4]])}));return function(e,t){return n.apply(this,arguments)}}(),window.fetch.__weblayerWrapped=!0,window.fetch.toString=function(){return u.toString()});var g=XMLHttpRequest.prototype.open,v=XMLHttpRequest.prototype.send;g.__weblayerWrapped||(XMLHttpRequest.prototype.open=function(e,t){return this._weblayerMethod=e,this._weblayerUrl=t,this._weblayerSkip="string"==typeof t&&t.includes("/qwerty/events"),g.apply(this,arguments)},XMLHttpRequest.prototype.send=function(){if(this._weblayerSkip)return v.apply(this,arguments);var n=performance.now(),o=this._weblayerMethod||"GET",i=this._weblayerUrl||"";return this.addEventListener("loadend",function(){try{var a=Math.round(performance.now()-n),s=sessionStorage.getItem("weblayer_session_id")||t;f({ts:y(),org_id:r.org_id,visitor_id:e,session_id:s,page_url:window.location.href,referrer:document.referrer||null,event_type:"network",event_name:o,event_data:{url:i,method:o},status:this.status||0,duration_ms:a})}catch(e){r.debug&&console.warn("[weblayer] Failed to track XHR:",e)}}),v.apply(this,arguments)},XMLHttpRequest.prototype.open.__weblayerWrapped=!0,XMLHttpRequest.prototype.send.__weblayerWrapped=!0);var w=new WeakSet;if(function(){try{var e=document.querySelectorAll("video"),t=document.querySelectorAll("audio");e.forEach(function(e){return R(e)}),t.forEach(function(e){return R(e)})}catch(e){r.debug&&console.warn("[weblayer] Failed to track existing media:",e)}}(),"undefined"!=typeof MutationObserver){var h=new MutationObserver(function(e){e.forEach(function(e){e.addedNodes.forEach(function(e){if(1===e.nodeType){"VIDEO"!==e.tagName&&"AUDIO"!==e.tagName||R(e);var t=e.querySelectorAll?e.querySelectorAll("video"):[],r=e.querySelectorAll?e.querySelectorAll("audio"):[];t.forEach(function(e){return R(e)}),r.forEach(function(e){return R(e)})}})})});try{h.observe(document.body,{childList:!0,subtree:!0})}catch(e){r.debug&&console.warn("[weblayer] Failed to set up media observer:",e)}}document.addEventListener("click",function(n){var o=n.target;if(o&&o.tagName){var i=sessionStorage.getItem("weblayer_session_id")||t;f({ts:y(),org_id:r.org_id,visitor_id:e,session_id:i,page_url:window.location.href,referrer:document.referrer||null,event_type:"click",event_name:o.tagName.toLowerCase(),event_data:{id:o.id||null,classes:o.className||null,text:p(o.textContent)}});var a=window.location.href,s=_.length,l=Date.now(),c=!1,u=setInterval(function(){_.length>s&&(c=!0,clearInterval(u))},50),d=function(){c=!0};document.addEventListener("focusin",d,{once:!0,capture:!0});var g=function(){clearInterval(u),document.removeEventListener("focusin",d,!0)},v=function(){try{var e=document.body.innerText.slice(0,1e3),t=document.querySelectorAll('[role="dialog"], .modal, .popup').length,r=document.querySelectorAll('[class*="loading"], [class*="spinner"], [class*="Loading"], [class*="Spinner"], [aria-busy="true"], [data-loading="true"], svg[class*="spin"], svg[class*="rotate"]').length,n=document.querySelectorAll("button:disabled, input:disabled").length,i="";try{if(!o||!o.isConnected)return"element-removed";i="".concat(o.className,"-").concat(o.disabled,"-").concat(o.getAttribute("aria-busy"))}catch(e){return"element-removed"}return"".concat(e.length,"-").concat(t,"-").concat(r,"-").concat(n,"-").concat(i)}catch(e){return"error"}},m=v(),w=function(n){try{var i=window.location.href!==a,s=v();if(i||m!==s||c)return void g();if(2===n){g();var u=window.getComputedStyle(o),d=!(!o.onclick&&!o.getAttribute("onclick")),_=u.cursor,w=["A","BUTTON","INPUT","SELECT","TEXTAREA"].includes(o.tagName),h="LABEL"===o.tagName&&o.htmlFor,b="A"===o.tagName&&o.href&&"#"!==o.href&&!o.href.startsWith("javascript:"),S=["INPUT","SELECT","TEXTAREA"].includes(o.tagName);if(w&&!h&&!S||d&&!b||"pointer"===_&&!h){var L=sessionStorage.getItem("weblayer_session_id")||t;f({ts:y(),org_id:r.org_id,visitor_id:e,session_id:L,page_url:window.location.href,referrer:document.referrer||null,event_type:"dead_click",event_name:"no_response",event_data:{element:{tag:o.tagName.toLowerCase(),id:o.id||null,classes:o.className||null,text:p(o.textContent),href:o.href||null},context:{expected_interactive:w,has_click_handler:d,cursor_style:_,time_since_click:Date.now()-l}}})}}}catch(e){r.debug&&console.warn("[weblayer] Dead-click detection failed:",e)}};setTimeout(function(){return w(1)},500),setTimeout(function(){return w(2)},1500)}},{capture:!0});var b=new WeakMap,S=null;document.addEventListener("mouseenter",function(n){try{var o=n.target;if(!o||!o.tagName)return;var i=Date.now();b.set(o,i),clearTimeout(S),S=setTimeout(function(){var n=sessionStorage.getItem("weblayer_session_id")||t;f({ts:y(),org_id:r.org_id,visitor_id:e,session_id:n,page_url:window.location.href,referrer:document.referrer||null,event_type:"hover",event_name:"mouseenter",event_data:{target_tag:o.tagName.toLowerCase(),target_id:o.id||null,target_classes:o.className||null}})},100)}catch(n){r.debug&&console.warn("[weblayer] Failed to track mouseenter:",n)}},{capture:!0}),document.addEventListener("mouseleave",function(n){try{var o=n.target;if(!o||!o.tagName)return;var i=b.get(o),a=i?Date.now()-i:null,s=sessionStorage.getItem("weblayer_session_id")||t;f({ts:y(),org_id:r.org_id,visitor_id:e,session_id:s,page_url:window.location.href,referrer:document.referrer||null,event_type:"hover",event_name:"mouseleave",event_data:{target_tag:o.tagName.toLowerCase(),target_id:o.id||null,target_classes:o.className||null,duration_ms:a}}),b.delete(o)}catch(n){r.debug&&console.warn("[weblayer] Failed to track mouseleave:",n)}},{capture:!0});var L=null;document.addEventListener("mouseover",function(n){try{var o=n.target;if(!o||!o.tagName)return;var i=o.tagName.toLowerCase();if(!(["a","button","input","select","textarea"].includes(i)||"button"===o.getAttribute("role")||null!==o.getAttribute("tabindex")))return;clearTimeout(L),L=setTimeout(function(){var n=sessionStorage.getItem("weblayer_session_id")||t;f({ts:y(),org_id:r.org_id,visitor_id:e,session_id:n,page_url:window.location.href,referrer:document.referrer||null,event_type:"hover",event_name:"hover",event_data:{target_tag:i,target_id:o.id||null,target_classes:o.className||null}})},100)}catch(n){r.debug&&console.warn("[weblayer] Failed to track mouseover:",n)}},{capture:!0});var E=null;document.addEventListener("touchstart",function(n){try{var o=sessionStorage.getItem("weblayer_session_id")||t,i=n.touches[0],a=n.target;f({ts:y(),org_id:r.org_id,visitor_id:e,session_id:o,page_url:window.location.href,referrer:document.referrer||null,event_type:"touch",event_name:"touchstart",event_data:{x:i?i.clientX:null,y:i?i.clientY:null,target_id:a&&a.id||null,target_tag:a&&a.tagName?a.tagName.toLowerCase():null,target_classes:a&&a.className||null,touches_count:n.touches.length}})}catch(n){r.debug&&console.warn("[weblayer] Failed to track touchstart:",n)}},{capture:!0}),document.addEventListener("touchend",function(n){try{var o=sessionStorage.getItem("weblayer_session_id")||t,i=n.changedTouches[0],a=n.target;f({ts:y(),org_id:r.org_id,visitor_id:e,session_id:o,page_url:window.location.href,referrer:document.referrer||null,event_type:"touch",event_name:"touchend",event_data:{x:i?i.clientX:null,y:i?i.clientY:null,target_id:a&&a.id||null,target_tag:a&&a.tagName?a.tagName.toLowerCase():null,target_classes:a&&a.className||null,touches_count:n.changedTouches.length}})}catch(n){r.debug&&console.warn("[weblayer] Failed to track touchend:",n)}},{capture:!0}),document.addEventListener("touchmove",function(n){try{clearTimeout(E),E=setTimeout(function(){var o=sessionStorage.getItem("weblayer_session_id")||t,i=n.touches[0],a=n.target;f({ts:y(),org_id:r.org_id,visitor_id:e,session_id:o,page_url:window.location.href,referrer:document.referrer||null,event_type:"touch",event_name:"touchmove",event_data:{x:i?i.clientX:null,y:i?i.clientY:null,target_id:a&&a.id||null,target_tag:a&&a.tagName?a.tagName.toLowerCase():null,target_classes:a&&a.className||null,touches_count:n.touches.length}})},100)}catch(n){r.debug&&console.warn("[weblayer] Failed to track touchmove:",n)}},{capture:!0});var N=null,I=null,k=null,T=window.scrollX||0,C=window.scrollY||0,A=(Date.now(),null);window.addEventListener("scroll",function(){try{clearTimeout(N),clearTimeout(I),N=setTimeout(function(){var e=window.scrollX||window.pageXOffset||0,t=window.scrollY||window.pageYOffset||0,r=Date.now(),n=null;if(k){var o=t-C;Math.abs(o)>10&&(n=o>0?"down":"up")}k&&(Math.abs(t-C)>10||Math.abs(e-T)>10)&&U(),T=e,C=t,I=setTimeout(function(){var e=window.scrollX||window.pageXOffset||0,t=window.scrollY||window.pageYOffset||0;W(e,t,n||(t>(C||0)?"down":t<(C||0)?"up":null))},600)},150)}catch(e){r.debug&&console.warn("[weblayer] Failed to track scroll:",e)}},{passive:!0}),window.addEventListener("beforeunload",function(){U()}),document.addEventListener("visibilitychange",function(){document.hidden&&U()});var O=null;document.addEventListener("selectstart",function(n){try{var o=n.target,i=sessionStorage.getItem("weblayer_session_id")||t;f({ts:y(),org_id:r.org_id,visitor_id:e,session_id:i,page_url:window.location.href,referrer:document.referrer||null,event_type:"selection",event_name:"selectstart",event_data:{target_tag:o&&o.tagName?o.tagName.toLowerCase():null}})}catch(n){r.debug&&console.warn("[weblayer] Failed to track selectstart:",n)}},{capture:!0}),document.addEventListener("selectionchange",function(){try{clearTimeout(O),O=setTimeout(function(){try{var n=window.getSelection();if(!n||0===n.rangeCount)return;var o=n.getRangeAt(0),i=o.toString();if(!i||0===i.trim().length)return;var a=sessionStorage.getItem("weblayer_session_id")||t;f({ts:y(),org_id:r.org_id,visitor_id:e,session_id:a,page_url:window.location.href,referrer:document.referrer||null,event_type:"selection",event_name:"selectionchange",event_data:{text_snippet:p(i,200),text_length:i.length,target_tag:o.commonAncestorContainer&&1===o.commonAncestorContainer.nodeType&&o.commonAncestorContainer.tagName?o.commonAncestorContainer.tagName.toLowerCase():null}})}catch(e){}},200)}catch(e){r.debug&&console.warn("[weblayer] Failed to track selectionchange:",e)}}),document.addEventListener("copy",function(n){try{var o=window.getSelection();if(!o||0===o.rangeCount)return;var i=o.getRangeAt(0),a=i.toString();if(!a||0===a.trim().length)return;var s=sessionStorage.getItem("weblayer_session_id")||t;f({ts:y(),org_id:r.org_id,visitor_id:e,session_id:s,page_url:window.location.href,referrer:document.referrer||null,event_type:"selection",event_name:"copy",event_data:{text_snippet:p(a,200),text_length:a.length,target_tag:i.commonAncestorContainer&&1===i.commonAncestorContainer.nodeType&&i.commonAncestorContainer.tagName?i.commonAncestorContainer.tagName.toLowerCase():null}})}catch(n){r.debug&&console.warn("[weblayer] Failed to track copy:",n)}},{capture:!0});var x=history.pushState,j=history.replaceState;history.pushState=function(){U(),x.apply(this,arguments);var n=sessionStorage.getItem("weblayer_session_id")||t;f({ts:y(),org_id:r.org_id,visitor_id:e,session_id:n,page_url:window.location.href,referrer:document.referrer||null,event_type:"navigation",event_name:"pushstate",event_data:{title:document.title,state:arguments[0]}})},history.replaceState=function(){U(),j.apply(this,arguments);var n=sessionStorage.getItem("weblayer_session_id")||t;f({ts:y(),org_id:r.org_id,visitor_id:e,session_id:n,page_url:window.location.href,referrer:document.referrer||null,event_type:"navigation",event_name:"replacestate",event_data:{title:document.title,state:arguments[0]}})},window.addEventListener("popstate",function(n){U();var o=sessionStorage.getItem("weblayer_session_id")||t;f({ts:y(),org_id:r.org_id,visitor_id:e,session_id:o,page_url:window.location.href,referrer:document.referrer||null,event_type:"navigation",event_name:"popstate",event_data:{title:document.title,state:n.state}})});var F=null;window.addEventListener("resize",function(){try{clearTimeout(F),F=setTimeout(function(){var n=sessionStorage.getItem("weblayer_session_id")||t;f({ts:y(),org_id:r.org_id,visitor_id:e,session_id:n,page_url:window.location.href,referrer:document.referrer||null,event_type:"resize",event_name:"window_resize",event_data:{width:window.innerWidth,height:window.innerHeight}})},300)}catch(e){r.debug&&console.warn("[weblayer] Failed to track resize:",e)}}),window.addEventListener("beforeunload",function(){m()});Date.now();var D=0,M=0,q=Date.now(),P=null;document.addEventListener("visibilitychange",function(){try{H();var n=sessionStorage.getItem("weblayer_session_id")||t;f({ts:y(),org_id:r.org_id,visitor_id:e,session_id:n,page_url:window.location.href,referrer:document.referrer||null,event_type:"visibility",event_name:document.hidden?"hidden":"visible",event_data:{active_time_ms:D,inactive_time_ms:M}}),document.hidden?(m(),P&&(clearInterval(P),P=null)):(P&&clearInterval(P),P=setInterval(function(){try{H();var n=sessionStorage.getItem("weblayer_session_id")||t;f({ts:y(),org_id:r.org_id,visitor_id:e,session_id:n,page_url:window.location.href,referrer:document.referrer||null,event_type:"visibility",event_name:"active_time_update",event_data:{active_time_ms:D,inactive_time_ms:M}})}catch(e){r.debug&&console.warn("[weblayer] Failed to update visibility:",e)}},3e4))}catch(e){r.debug&&console.warn("[weblayer] Failed to track visibility:",e)}}),document.hidden||(q=Date.now(),P=setInterval(function(){try{H();var n=sessionStorage.getItem("weblayer_session_id")||t;f({ts:y(),org_id:r.org_id,visitor_id:e,session_id:n,page_url:window.location.href,referrer:document.referrer||null,event_type:"visibility",event_name:"active_time_update",event_data:{active_time_ms:D,inactive_time_ms:M}})}catch(e){r.debug&&console.warn("[weblayer] Failed to update visibility:",e)}},3e4))}function X(n,i){try{var a=i.target;if(!a||!a.tagName)return;var s=a.tagName.toLowerCase();if(!["input","textarea","select"].includes(s))return;var l=sessionStorage.getItem("weblayer_session_id")||t,c={field_type:a.type||s,field_name:a.name||null,field_id:a.id||null,has_value:!!(a.value&&a.value.length>0),value_length:(a.value||"").length};"focus"===n&&o.set(a,Date.now()),f({ts:y(),org_id:r.org_id,visitor_id:e,session_id:l,page_url:window.location.href,referrer:document.referrer||null,event_type:"form_interaction",event_name:n,event_data:c})}catch(i){r.debug&&console.warn("[weblayer] Failed to track form ".concat(n,":"),i)}}function R(n){if(!w.has(n)&&(n.src||n.srcObject)){w.add(n);["play","pause","ended","seeking","timeupdate","volumechange","error"].forEach(function(o){n.addEventListener(o,function(n){try{var i=sessionStorage.getItem("weblayer_session_id")||t,a=n.target,s=a.src||(a.srcObject?"blob/object":null)||null;if(!s&&!a.srcObject)return;f({ts:y(),org_id:r.org_id,visitor_id:e,session_id:i,page_url:window.location.href,referrer:document.referrer||null,event_type:"media",event_name:o,event_data:{element_type:a.tagName.toLowerCase(),src:p(s,200),current_time:a.currentTime||null,duration:a.duration||null,volume:void 0!==a.volume?a.volume:null,muted:void 0!==a.muted?a.muted:null,paused:void 0!==a.paused?a.paused:null}})}catch(n){r.debug&&console.warn("[weblayer] Failed to track media ".concat(o,":"),n)}})})}}function W(e,t,n){try{var o=Date.now(),a=(sessionStorage.getItem("weblayer_session_id"),function(){try{var e=window.scrollY||window.pageYOffset||0,t=e+window.innerHeight,n=window.scrollX||window.pageXOffset||0,o=n+window.innerWidth,a=[],s=[],l=[];if("undefined"!=typeof IntersectionObserver)document.querySelectorAll('h1, h2, h3, h4, h5, h6, p, img, [role="heading"]').forEach(function(r){try{var i=r.getBoundingClientRect(),c=e+i.top,u=c+i.height,d=n+i.left,_=d+i.width;if(u>e&&c<t&&_>n&&d<o&&i.width>0&&i.height>0){var g=r.tagName?r.tagName.toLowerCase():"";if(g.match(/^h[1-6]$/)||"heading"===r.getAttribute("role")){var f=p(r.textContent||r.innerText,200);f&&a.push({level:g,text:f})}else if("img"===g){var v=p(r.alt,100),m=p(r.src,200);l.push({alt:v||null,src:m||null})}else if("p"===g||r.textContent){var w=p(r.textContent||r.innerText,300);if(w&&!s.includes(w)&&(s.push(w),s.join(" ").length>=1e3))return}}}catch(e){}});else{var c=e+window.innerHeight/2,u=n+window.innerWidth/2;[[u,c],[u,e+.25*window.innerHeight],[u,e+.75*window.innerHeight]].forEach(function(t){var r=i(t,2),o=r[0],l=r[1];try{var c=document.elementFromPoint(o-n,l-e);if(c){var u=c.tagName?c.tagName.toLowerCase():"";if(u.match(/^h[1-6]$/)){var d=p(c.textContent,200);d&&a.push({level:u,text:d})}else if(c.textContent){var _=p(c.textContent,300);_&&!s.includes(_)&&s.push(_)}}}catch(e){}})}return{headings:a.slice(0,10),text_snippets:s.slice(0,5),images:l.slice(0,5)}}catch(e){return r.debug&&console.warn("[weblayer] Failed to capture visible content:",e),{headings:[],text_snippets:[],images:[]}}}()),s={scroll_x:e,scroll_y:t,viewport_width:window.innerWidth,viewport_height:window.innerHeight,visible_content:a,scroll_direction:n,stop_time:o};k=s,A&&(clearInterval(A),A=null),A=setInterval(function(){if(k&&k.stop_time){var e=Date.now()-k.stop_time;k.duration_ms=e}},2e3)}catch(e){r.debug&&console.warn("[weblayer] Failed to record scroll stop:",e)}}function U(){if(k)try{var n=sessionStorage.getItem("weblayer_session_id")||t,o=Date.now()-(k.stop_time||Date.now());f({ts:y(),org_id:r.org_id,visitor_id:e,session_id:n,page_url:window.location.href,referrer:document.referrer||null,event_type:"scroll",event_name:"scroll_stop",event_data:{scroll_x:k.scroll_x,scroll_y:k.scroll_y,viewport_width:k.viewport_width,viewport_height:k.viewport_height,visible_content:k.visible_content,scroll_direction:k.scroll_direction,duration_ms:o}}),k=null,A&&(clearInterval(A),A=null)}catch(e){r.debug&&console.warn("[weblayer] Failed to flush scroll stop:",e)}}function H(){var e=Date.now();document.hidden?M+=e-q:D+=e-q,q=e}}function b(e){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b(e)}function S(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,L(n.key),n)}}function L(e){var t=function(e,t){if("object"!=b(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=b(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==b(t)?t:t+""}var E=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},n=[{key:"init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e){r.org_id=e,r.apiUrl=t.apiUrl||r.apiUrl||"https://api.weblayer.ai",r.debug=t.debug||!1,r.weblayerEnabled=!1!==t.weblayerEnabled,r.debug&&(console.log("[weblayer] Initializing WebLayer SDK with orgId:",e),console.log("[weblayer] API URL:",r.apiUrl));var n=o();if(n){r.debug&&console.log("[weblayer] Visitor ID:",n);try{h(n)}catch(e){console.error("[weblayer] Failed to initialize tracking:",e)}}else console.error("[weblayer] Failed to create visitor ID")}else console.error("[weblayer] orgId is required")}}],(t=null)&&S(e.prototype,t),n&&S(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();"undefined"!=typeof window&&(window.WebLayerSDK=E,function(){var e=document.currentScript;if(!e)for(var t=document.getElementsByTagName("script"),r=t.length-1;r>=0;r--){var n=t[r],o=n.src||"";if(o.includes("weblayer-sdk")||o.includes("sdk.weblayer.ai")){e=n;break}}if(e){var i=null;try{var a=new URL(e.src),s=a.pathname.split("/").filter(function(e){return e.length>0});s.length>0&&a.hostname.includes("sdk.weblayer.ai")&&(i=s[s.length-1])}catch(t){var l=e.src||"";if(l.includes("sdk.weblayer.ai/")){var c=l.match(/sdk\.weblayer\.ai\/([^\/\?#]+)/);c&&c[1]&&(i=c[1])}}i||(i=e.getAttribute("data-org-id")),i&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){E.init(i)}):E.init(i))}}());const N=E;window.WebLayerSDK=t})();